# ğŸ” Keycloak como IDP Local com Docker Swarm e Traefik
Este serviÃ§o disponibiliza uma instÃ¢ncia do [Keycloak](https://www.keycloak.org/) como **Identity Provider (IDP)** para autenticaÃ§Ã£o local, com HTTPS via **Traefik**, ideal para desenvolvimento e testes de SSO (Single Sign-On), OAuth2, OpenID Connect e autenticaÃ§Ã£o centralizada.

---

## ğŸ“ Estrutura do Projeto

```
keycloak/
â”œâ”€â”€ docker-compose.yml       # Stack Docker Swarm do Keycloak + Postgres
â””â”€â”€ README.md                # Este arquivo
```

---

## ğŸ§° ServiÃ§os DisponÃ­veis

### ğŸ”‘ Keycloak

* Interface Web em: [https://auth.infra.local](https://auth.infra.local)
* Admin Console com usuÃ¡rio `admin` e senha `admin`
* Utiliza PostgreSQL como banco de dados
* Executado em modo `start-dev` para facilitar o uso em desenvolvimento

### ğŸ—ƒï¸ Banco de Dados

* PostgreSQL 15
* Volume persistente: `keycloak_db_data`

---

## âš™ï¸ ConfiguraÃ§Ãµes do Keycloak

| VariÃ¡vel de ambiente      | Valor       |
| ------------------------- | ----------- |
| `KC_DB`                   | postgres    |
| `KC_DB_URL_HOST`          | keycloak-db |
| `KC_DB_URL_DATABASE`      | keycloak    |
| `KC_DB_USERNAME`          | keycloak    |
| `KC_DB_PASSWORD`          | secret      |
| `KEYCLOAK_ADMIN`          | admin       |
| `KEYCLOAK_ADMIN_PASSWORD` | admin       |

---

## ğŸ” IntegraÃ§Ã£o com Traefik

O serviÃ§o estÃ¡ pronto para ser roteado pelo Traefik com HTTPS:

* DomÃ­nio: `https://auth.infra.local`
* Porta interna: `8080`
* Roteamento configurado via labels

---

## ğŸ“œ PrÃ©-requisitos

### ğŸ§¾ Entrada no `/etc/hosts`

Adicione a seguinte linha:

```
127.0.0.1 auth.infra.local
```

### ğŸ” GeraÃ§Ã£o de Certificado SSL com `mkcert`

```bash
mkcert auth.infra.local
```

* Coloque os arquivos `.pem` gerados no diretÃ³rio de certificados do Traefik.

---

## ğŸš€ Deploy da Stack

Para subir o serviÃ§o no Docker Swarm:

```bash
docker stack deploy -c docker-compose.yml keycloak
```

---

## ğŸ§ª Acessando

1. Abra `https://auth.infra.local` no navegador.
2. FaÃ§a login com:

   * **UsuÃ¡rio:** `admin`
   * **Senha:** `admin`

---

## ğŸ› ï¸ Dicas de ConfiguraÃ§Ã£o AvanÃ§ada

* Utilize `start` ao invÃ©s de `start-dev` para produÃ§Ã£o.
* Configure SMTP para redefiniÃ§Ã£o de senhas.
* Habilite login com provedores externos (Google, GitHub, etc).

---

Com isso, vocÃª tem um **IDP local robusto**, com roteamento HTTPS confiÃ¡vel para integrar suas aplicaÃ§Ãµes internas com autenticaÃ§Ã£o unificada via Keycloak.
