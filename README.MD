# Infraestrutura de Desenvolvimento com Docker Swarm e Traefik

Este projeto configura um ambiente de desenvolvimento completo com Docker Swarm, centralizando serviÃ§os essenciais como Traefik, PostgreSQL, Portainer, Grafana e Odoo, com suporte a HTTPS local utilizando `mkcert`.

## Estrutura Geral do Projeto

```bash
infra-tools/
â”œâ”€â”€ certs/                           # Certificados SSL gerados com mkcert
â”œâ”€â”€ traefik/                         # Proxy reverso com HTTPS local
â”œâ”€â”€ postgres/                        # Banco de dados PostgreSQL para dev
â”œâ”€â”€ portainer/                       # Interface de gerenciamento de containers
â”œâ”€â”€ monitoring/                      # Grafana e Prometheus
â”œâ”€â”€ odoo/                            # Plataforma Odoo com suporte a debug remoto
â”‚   â”œâ”€â”€ docker/                      # Dockerfiles por versÃ£o
â”‚   â”‚   â””â”€â”€ 18.0/Dockerfile          # Dockerfile com debugpy
â”‚   â”œâ”€â”€ versions/                    # CÃ³digo oficial clonado por versÃ£o
â”‚   â”œâ”€â”€ addons/                      # MÃ³dulos personalizados
â”‚   â””â”€â”€ instances/
â”‚       â””â”€â”€ dev/                     # InstÃ¢ncia de desenvolvimento
â”‚           â”œâ”€â”€ config/odoo.conf
â”‚           â”œâ”€â”€ logs/
â”‚           â””â”€â”€ docker-compose.yml
```

## Funcionalidades

### ğŸ” Traefik com HTTPS Local

* Gerenciamento de roteamento com SSL local usando `mkcert`
* Acesso via domÃ­nios personalizados como `traefik.infra.local`, `portainer.infra.local`, etc
* ConfiguraÃ§Ã£o dinÃ¢mica via `traefik_dynamic.toml`

### ğŸ—ƒï¸ PostgreSQL para Desenvolvimento

* Rodando em container isolado
* IntegraÃ§Ã£o direta com Odoo
* Acesso local via `localhost:5432` e pela rede Swarm via `postgres`

### ğŸ“Š Portainer

* Interface web para gerenciamento de stacks, serviÃ§os e containers
* Acesso com HTTPS local em `https://portainer.infra.local`

### ğŸ“ˆ Grafana

* Dashboard de visualizaÃ§Ã£o com HTTPS local em `https://grafana.portainer.infra.local`
* Pronto para se integrar com Prometheus e cAdvisor

### ğŸ§  Odoo com Debug Remoto

* Estrutura baseada em instÃ¢ncias por pasta
* Build customizado com `debugpy` e `pandas`
* ConfiguraÃ§Ã£o via `odoo.conf` e Traefik para domÃ­nio `dev.infra.local`
* Porta `5678` publicada para conexÃ£o com PyCharm
* Breakpoints funcionam no core e em mÃ³dulos personalizados

## Rede Compartilhada

Todos os serviÃ§os usam a rede externa `keiko_network`, o que permite comunicaÃ§Ã£o entre containers como:

* Odoo acessando o banco PostgreSQL via `postgres`
* Grafana acessando Prometheus (em futuras integraÃ§Ãµes)
* Portainer gerenciando containers de todas as stacks

## Certificados com mkcert

```bash
mkcert traefik.infra.local
mkcert portainer.infra.local
mkcert grafana.portainer.infra.local
mkcert dev.infra.local
```

Os certificados `.pem` sÃ£o montados diretamente no Traefik para HTTPS local confiÃ¡vel.

## Hosts Locais

Adicione ao `/etc/hosts`:

```bash
127.0.0.1 traefik.infra.local portainer.infra.local grafana.portainer.infra.local dev.infra.local
```

## Deploy das Stacks

```bash
cd traefik && docker stack deploy -c docker-compose.yml traefik
cd postgres && docker stack deploy -c docker-compose.yml postgres
cd portainer && docker stack deploy -c docker-compose.yml portainer
cd monitoring && docker stack deploy -c docker-compose.yml monitoring
cd odoo/instances/dev && docker stack deploy -c docker-compose.yml odoo_dev
```

---

Com isso, vocÃª terÃ¡ um ambiente local robusto e realista para desenvolvimento, testes e validaÃ§Ãµes de serviÃ§os que simulam a produÃ§Ã£o.
