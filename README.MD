# Infraestrutura Local de Desenvolvimento com Docker Swarm & Traefik

Este repositÃ³rio fornece uma infraestrutura local completa e segura para ambientes de desenvolvimento, utilizando **Docker Swarm**, **Traefik** como proxy reverso com HTTPS local, e serviÃ§os essenciais como:

- ğŸ” AutenticaÃ§Ã£o com **Keycloak** (Auth)
- ğŸ“¨ Servidor de E-mail com **Postfix + Dovecot**
- ğŸ˜ Banco de Dados **PostgreSQL**
- ğŸ‡ Mensageria com **RabbitMQ**
- ğŸ” Monitoramento com **Grafana + Prometheus**
- âš™ï¸ Gerenciamento com **Portainer**
- âš¡ OrquestraÃ§Ã£o com **Traefik**
- ğŸ“¡ OrquestraÃ§Ã£o de dados com **Apache NiFi**

Todos os serviÃ§os compartilham a rede `keiko_network` e podem ser acessados com domÃ­nios `.infra.local`, com certificados gerados por `mkcert`.

---

## ğŸ“ Estrutura de DiretÃ³rios

```bash
infra-tools/
â”œâ”€â”€ auth/           â†’ Keycloak configurado como IDP local
â”œâ”€â”€ certs/          â†’ Certificados locais (.pem) gerados com mkcert
â”œâ”€â”€ mail-server/    â†’ Servidor SMTP/IMAP local (Postfix + Dovecot + SSL)
â”œâ”€â”€ monitoring/     â†’ Grafana + Prometheus configurados com SSL
â”œâ”€â”€ nifi/           â†’ Apache NiFi com acesso seguro via Traefik
â”œâ”€â”€ portainer/      â†’ Gerenciamento de containers e stacks
â”œâ”€â”€ postgres/       â†’ Banco de dados PostgreSQL (modo swarm)
â”œâ”€â”€ rabbitmq/       â†’ RabbitMQ com UI via Traefik e SSL
â”œâ”€â”€ traefik/        â†’ ConfiguraÃ§Ã£o do Traefik e certificados HTTPS
â””â”€â”€ README.md       â†’ Este arquivo
````

---

## ğŸ” Certificados com `mkcert`

Os certificados foram gerados localmente com [mkcert](https://github.com/FiloSottile/mkcert):

```bash
mkcert traefik.infra.local
mkcert portainer.infra.local
mkcert grafana.infra.local
mkcert mail.infra.local
mkcert nifi.infra.local
mkcert rabbitmq.infra.local
````

Os arquivos `.pem` estÃ£o em `./certs/` e sÃ£o montados nos containers via volume.

---

## ğŸ§  ServiÃ§os DisponÃ­veis

| ServiÃ§o     | URL                                                            | Porta interna | Stack dir      |
| ----------- | -------------------------------------------------------------- | ------------- | -------------- |
| Traefik     | [https://traefik.infra.local](https://traefik.infra.local)     | 8080          | `traefik/`     |
| Portainer   | [https://portainer.infra.local](https://portainer.infra.local) | 9000          | `portainer/`   |
| Grafana     | [https://grafana.infra.local](https://grafana.infra.local)     | 3000          | `monitoring/`  |
| PostgreSQL  | (sem UI, acesso via apps)                                      | 5432          | `postgres/`    |
| RabbitMQ    | [https://rabbitmq.infra.local](https://rabbitmq.infra.local)   | 15672         | `rabbitmq/`    |
| Keycloak    | [https://auth.infra.local](https://auth.infra.local)           | 8080          | `auth/`        |
| NiFi        | [https://nifi.infra.local](https://nifi.infra.local)           | 8443          | `nifi/`        |
| Mail Server | SMTP (2525/465), IMAP (2143/993)                               | vÃ¡rios        | `mail-server/` |

---

## âš™ï¸ Como executar

1. Inicialize a rede compartilhada:

```bash
docker network create --driver=overlay --attachable keiko_network
```

2. FaÃ§a o deploy de cada stack (em modo swarm):

```bash
cd traefik && docker stack deploy -c docker-compose.yml traefik
cd postgres && docker stack deploy -c docker-compose.yml postgres
cd portainer && docker stack deploy -c docker-compose.yml portainer
cd monitoring && docker stack deploy -c docker-compose.yml monitoring
cd rabbitmq && docker stack deploy -c docker-compose.yml rabbitmq
cd auth && docker stack deploy -c docker-compose.yml auth
cd mail-server && docker stack deploy -c docker-compose.yml mail
cd nifi && docker stack deploy -c docker-compose.yml nifi
```

---

## ğŸ› ï¸ Requisitos

* Docker + Docker Swarm
* mkcert instalado e confiÃ¡vel no sistema
* DomÃ­nios adicionados em `/etc/hosts`:

```bash
127.0.0.1 traefik.infra.local portainer.infra.local grafana.infra.local mail.infra.local rabbitmq.infra.local auth.infra.local nifi.infra.local
```

---

## ğŸ“Š Monitoramento

* **Grafana** e **Prometheus** monitoram containers e serviÃ§os.
* PrÃ©-configuraÃ§Ãµes podem ser adicionadas via `prometheus.yml` e dashboards JSON.

---

## âœ‰ï¸ Servidor de E-mail Local

* Postfix e Dovecot com suporte a SSL/TLS.
* UsuÃ¡rios podem ser configurados via arquivos `userdb`, `passdb`, etc.
* Ideal para testes de envio/recebimento de e-mails em ambiente de desenvolvimento.

---

## ğŸ§ª Teste e ValidaÃ§Ã£o

VocÃª pode testar o acesso seguro a qualquer serviÃ§o via navegador, ou com `curl`:

```bash
curl -k https://grafana.infra.local
curl -k https://portainer.infra.local
```

---

## ğŸ“Œ ObservaÃ§Ãµes

* Todos os certificados sÃ£o **locais**. NÃ£o usar em produÃ§Ã£o.
* ServiÃ§os utilizam **Traefik com entrypoint `websecure`**.
* Estrutura modular permite a inclusÃ£o de outros serviÃ§os futuros.

---

## ğŸ“‚ CrÃ©ditos e LicenÃ§a

Desenvolvido para uso interno e ambientes de desenvolvimento.
LicenÃ§a MIT.

---
