## ğŸ”€ Traefik - Proxy Reverso com HTTPS Local

Este serviÃ§o fornece o proxy reverso central da infraestrutura. Ele Ã© responsÃ¡vel por:

* Encaminhar trÃ¡fego HTTPS para os serviÃ§os internos com base no domÃ­nio.
* Gerenciar certificados locais gerados com [mkcert](https://github.com/FiloSottile/mkcert).
* Servir a UI de administraÃ§Ã£o do Traefik via dashboard.

---

### ğŸ§© Principais Funcionalidades

* Entrada Ãºnica para todos os serviÃ§os via HTTPS local.
* IntegraÃ§Ã£o com Docker Swarm e labels para roteamento automÃ¡tico.
* Suporte a certificados gerados com mkcert.
* UI disponÃ­vel em `https://traefik.infra.local`.

---

### ğŸ—‚ï¸ Estrutura de Arquivos

```
traefik/
â”œâ”€â”€ docker-compose.yml       # Stack Traefik com suporte a HTTPS
â”œâ”€â”€ acme.json                # Certificados gerenciados por Traefik (deixe com chmod 600)
â”œâ”€â”€ traefik.toml             # ConfiguraÃ§Ã£o principal do Traefik
â””â”€â”€ traefik_dynamic.toml     # Regras dinÃ¢micas, middlewares, TLS, etc.
```

---

### âš™ï¸ Como funciona

* O serviÃ§o `traefik` escuta em duas portas:

  * `80` (HTTP) â†’ redireciona para HTTPS
  * `443` (HTTPS) â†’ entrada principal com certificados locais

* A configuraÃ§Ã£o `traefik.toml` aponta para `traefik_dynamic.toml`, onde estÃ£o definidos:

  * Middlewares como redirecionamento, autenticaÃ§Ã£o, etc
  * Certificados TLS estÃ¡ticos
  * Roteamento baseado em `Host()` (ex: `grafana.infra.local`)

---

### ğŸ” Certificados Locais

Os certificados sÃ£o gerados com mkcert e montados dentro do container:

```bash
mkcert traefik.infra.local
```

```toml
[tls.certificates]
  certFile = "/etc/traefik/certs/traefik.infra.local.pem"
  keyFile = "/etc/traefik/certs/traefik.infra.local-key.pem"
```

---

### ğŸ” Acessos

| URL                                                        | DescriÃ§Ã£o                      |
| ---------------------------------------------------------- | ------------------------------ |
| [https://traefik.infra.local](https://traefik.infra.local) | Painel do Traefik (porta 8080) |

---

### ğŸ“¦ Deploy

```bash
docker stack deploy -c traefik/docker-compose.yml traefik
```

> Lembre-se de que todos os outros serviÃ§os devem estar na mesma rede `keiko_network` para serem roteados corretamente.

---

### ğŸ” SeguranÃ§a

* A dashboard pode ser protegida com middleware de autenticaÃ§Ã£o.
* Para ambientes sensÃ­veis, Ã© recomendÃ¡vel habilitar autenticaÃ§Ã£o bÃ¡sica ou OAuth2.

