# ğŸ§© Monitoramento com Docker Swarm, Traefik, Grafana, Prometheus e cAdvisor

Esta stack provÃª uma soluÃ§Ã£o de **monitoramento local** utilizando Docker Swarm com HTTPS via `Traefik` + `mkcert`. VocÃª poderÃ¡ visualizar mÃ©tricas de containers Docker e serviÃ§os em tempo real.

---

## ğŸ“¦ Tecnologias Utilizadas

* âœ… **Grafana** â€“ Dashboards de visualizaÃ§Ã£o
* âœ… **Prometheus** â€“ Coletor de mÃ©tricas
* âœ… **cAdvisor** â€“ Monitoramento de containers Docker
* âœ… **Traefik** â€“ Proxy reverso com suporte a TLS local (via `mkcert`)

---

## ğŸ“ Estrutura do Projeto

```bash
monitoring/
â”œâ”€â”€ docker-compose.yml         # Stack de monitoramento com Traefik
â”œâ”€â”€ prometheus.yml             # Configura os alvos de scraping do Prometheus
â””â”€â”€ README.md                  # Este documento
```

---

## ğŸš€ ServiÃ§os

### ğŸ“Š Grafana

* Interface: [https://grafana.infra.local](https://grafana.infra.local)
* Porta interna: `3000`
* PersistÃªncia: volume `grafana_data`
* Integrado com Prometheus como data source

### ğŸ“¡ Prometheus

* Interface: [http://localhost:9090](http://localhost:9090)
* Porta interna: `9090`
* Scrape configurado para:

  * Ele mesmo (`localhost:9090`)
  * cAdvisor (`cadvisor:8080`)
* Armazena mÃ©tricas localmente (pode ser estendido com Alertmanager)

### ğŸ“¦ cAdvisor

* Interface: [http://localhost:8081](http://localhost:8081) (opcional)
* ExpÃµe mÃ©tricas dos containers Docker
* LÃª dados diretamente do host via `/var/run/docker.sock`

---

## ğŸ” HTTPS Local com Traefik e mkcert

Certificados locais sÃ£o usados para HTTPS realista em ambiente de desenvolvimento.

### ğŸ“Œ Gerando Certificados

```bash
mkcert grafana.infra.local
```

Coloque os arquivos `.pem` gerados no diretÃ³rio de certificados do Traefik (`../traefik/certs/`).

---

## ğŸ”§ ConfiguraÃ§Ã£o do Prometheus

```yaml
# monitoring/prometheus.yml

global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
```

---

## ğŸ–¥ï¸ /etc/hosts

Adicione as seguintes entradas no seu arquivo `/etc/hosts`:

```bash
127.0.0.1 grafana.infra.local
```

---

## ğŸ³ Deploy da Stack

### 1. Inicie o Docker Swarm (caso ainda nÃ£o esteja ativo):

```bash
docker swarm init
```

### 2. Suba a stack:

```bash
docker stack deploy -c monitoring/docker-compose.yml monitoring
```

---

## ğŸŒ Acessos

| ServiÃ§o    | URL                                                        | Porta |
| ---------- | ---------------------------------------------------------- | ----- |
| Grafana    | [https://grafana.infra.local](https://grafana.infra.local) | 3000  |
| Prometheus | [http://localhost:9090](http://localhost:9090)             | 9090  |
| cAdvisor   | [http://localhost:8081](http://localhost:8081)             | 8080  |

---

## ğŸ“‚ Volumes

| Nome              | Uso                              |
| ----------------- | -------------------------------- |
| `grafana_data`    | Dados e configuraÃ§Ãµes do Grafana |
| `prometheus_data` | Banco de mÃ©tricas do Prometheus  |

---

## âœ… PrÃ³ximos Passos

* [ ] Adicionar dashboards automÃ¡ticos no Grafana (via provisioning)
* [ ] Configurar autenticaÃ§Ã£o via Keycloak ou OAuth no Grafana
* [ ] Adicionar Alertmanager para alertas de eventos crÃ­ticos

---

ğŸ’¡ **Dica**: VocÃª pode integrar o Grafana com outras fontes de dados como Loki, Elasticsearch ou PostgreSQL dependendo da necessidade da sua infraestrutura.

---